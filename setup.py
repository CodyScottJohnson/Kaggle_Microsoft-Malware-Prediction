import subprocess
import os, zipfile
from halo import Halo
import click
#Unzip Files and Delete Zipped Files
def UnzipFiles():
    spinner = Halo(text='Unpacking Data', spinner='dots')
    spinner.start()
    for item in os.listdir('data'): # loop through items in dir 
        if item.endswith('.zip'): # check for ".zip" extension
            file_name = os.path.abspath('data/' + item) # get full path of files
            zip_ref = zipfile.ZipFile(file_name) # create zipfile object
            zip_ref.extractall('data') # extract file to dir
            zip_ref.close() # close file
            #os.remove(file_name) # delete zipped file
    spinner.succeed('Data Unpacked')
    pass
#Download Competition Files
@Halo(text='Downloading Files...', spinner='dots')
def DownloadFiles():
    subprocess.check_call(['kaggle','competitions','download','microsoft-malware-prediction','--path','data'])
    pass
@Halo(text='Preparing Development Environment', spinner='dots')    
def LaunchEnvironment():
    spinner = Halo(text='Launching Environment', spinner='dots')
    spinner.start()
    spinner.succeed('Environment Ready')
    subprocess.check_call(['pipenv', 'run', 'jupyter', 'notebook','--config', './notebook_config.py'])
    
    
    pass
@click.group()
def cli():
    """This script performs basic setup operations such 
    as downloading data and starting a development 
    environment in jupyter."""
    pass

@click.command()
def init():
    """Downloads data from kaggle and starts Jupyter server"""
    DownloadFiles()
    UnzipFiles()
    LaunchEnvironment()

@click.command()
def serve():
    """Starts Jupyter server"""
    LaunchEnvironment()

cli.add_command(init)
cli.add_command(serve)

if __name__ == '__main__':
    cli()




